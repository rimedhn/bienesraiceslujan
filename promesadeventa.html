<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CONTRATO DE PROMESA DE VENTA</title>
  <style>
    /* Global typography */
    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      margin: 30px;
      -webkit-print-color-adjust: exact;
    }

    /* Container for the main contract text */
    #content {
      text-align: justify;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    /* Title styling: centered and bold */
    .title {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 16px; /* requested overall size 12 */
    }

    /* Inline field placeholders */
    [data-field] {
      /* default normal weight; specific fields will be rendered bold by the script when needed */
    }

    /* Signature layout: stacked vertically for easier gestión */
    .signatures-top {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 28px;
      gap: 18px;
    }

    .sig {
      width: 100%;
      text-align: center;
    }

    /* Make all signature lines the same visual width as buyer lines */
    .sig .hrline {
      border-top: 1px solid #000;
      height: 1px;
      width: 60%;
      margin: 18px auto 8px auto;
    }

    /* Buyers signature line: give more vertical space above and below for actual signing */
    .buyer-block .hrline {
      border-top: 1px solid #000;
      height: 1px;
      width: 60%;
      margin: 36px auto 30px auto; /* increased space for signature and between line and printed name */
    }

    .sig .name {
      margin-top: 6px;
      font-weight: bold;
    }

    .sig .role {
      margin-top: 2px;
    }

    /* Buyers signatures: centered blocks, one per buyer */
    #buyers {
      margin-top: 8px;
      width: 100%;
    }

    .buyer-block {
      text-align: center;
      margin-top: 24px;
      page-break-inside: avoid;
    }

    .buyer-block .buyer-name {
      font-weight: bold;
      margin-top: 12px;
      text-transform: uppercase;
    }

    .buyer-block .buyer-role {
      margin-top: 2px;
      font-style: normal;
    }

    /* Prevent signature blocks from collapsing at page breaks */
    .sig, .buyer-block { break-inside: avoid; }

    /* Enumerators wrapped will use this class */
    .enumerator { font-weight: bold; }

    /* Print adjustments */
    @media print {
      body { margin: 10mm; }
      .signatures-top { gap: 25px; }
    }
  </style>
</head>
<body>
  <div id="content">
    <div class="title">CONTRATO DE PROMESA DE VENTA</div>

NOSOTROS: <span data-field="Representante">&lt;&lt;Representante&gt;&gt;</span>, <span data-field="Datosrepresentante">&lt;&lt;Datosrepresentante&gt;&gt;</span> <span data-field="NombreEmpresa">&lt;&l[...]
    <strong>-PRIMERA:</strong> EL (LA) PROMINENTE VENDEDOR (A), en la condición con que actúa, manifiesta que su representado (a) es dueño (a) de un lote de terreno el cual se describe así: ubicad[...]
    <strong>-SEGUNDA:</strong> LA PROMINENTE VENDEDORA, en la condición con que actúa  por tenerlo así convenido, al precio y condiciones que se establecen en las cláusulas siguientes, por este ac[...]
    <strong>-TERCERA:</strong> Continua manifestando EL (LA) PROMINENTE VENDEDOR (A), en la condición con que actúa, que el contrato de promesa de compraventa a ser suscrito, en ejecución de esta p[...]
    <strong>-CUARTA:</strong> El precio de la venta total del lote de terreno será por <span data-field="MontoLetras">&lt;&lt;MontoLetras&gt;&gt;</span> LEMPIRAS EXACTOS (LPS  <span data-field="Monto[...]
    <strong>-QUINTA:</strong> El plazo para el cumplimiento en cuanto a la transferencia de dominio en escritura pública o suscripción de la compraventa se establecerá por los Abogados del BUFETE L[...]
    <strong>-SEXTA:</strong> Durante el tiempo en que <span data-field="ElProminenteComprador">&lt;&lt;ElProminenteComprador&gt;&gt;</span> no haya suscrito la escritura de compraventa, y pasado seis [...]
    <strong>-SEPTIMA:</strong> Estará a Cargo de <span data-field="ElProminenteComprador">&lt;&lt;ElProminenteComprador&gt;&gt;</span>: A) Gestionar personalmente la instalación  de los Servicios P�[...]
    <strong>-OCTAVA:</strong> Por su parte EL (LA) PROMINENTE VENDEDOR (A), en la condición con que actúa por este acto se obliga a: 1) la electrificación e iluminación del proyecto, exceptuando l[...]
    <strong>-NOVENA:</strong> Queda Prohibido <span data-field="AlProminenteComprador">&lt;&lt;AlProminenteComprador&gt;&gt;</span> y a sus descendientes: a) Utilizar el inmueble para fines de depósi[...]
    <strong>-DECIMA:</strong>  El plazo de este contrato es de <span data-field="PlazoLetras">&lt;&lt;PlazoLetras&gt;&gt;</span> MESES, contados a partir de la fecha de suscripción, al final del cual[...]
    <strong>-DECIMO PRIMERA:</strong> En caso que <span data-field="ElProminenteComprador">&lt;&lt;ElProminenteComprador&gt;&gt;</span> o sus herederos incumplieron con las obligaciones a su cargo o i[...]
    <strong>-DECIMO SEGUNDA:</strong> Queda expresamente convenido y así lo acepta <span data-field="ElProminenteComprador">&lt;&lt;ElProminenteComprador&gt;&gt;</span>. a) Que la conformación o niv[...]
    <strong>-DECIMO TERCERA:</strong> <span data-field="ElProminenteComprador">&lt;&lt;ElProminenteComprador&gt;&gt;</span>  renuncia expresamente al fuero de su domicilio y se somete, en caso de conf[...]
    <strong>-DECIMO CUARTA:</strong> <span data-field="DatosCompradorFinalContrato">&lt;&lt;DatosCompradorFinalContrato&gt;&gt;</span>, que es cierto todo lo expresado por el (la) señor (a) <span dat[...]
En la ciudad de La Ceiba, departamento de Atlántida a los <span data-field="FechaLetras">&lt;&lt;FechaLetras&gt;&gt;</span>
  </div>

  <!-- Signatures: stacked vertically -->
  <div class="signatures-top">
    <div class="sig" id="sig-representante">
      <div class="hrline"></div>
      <div class="name" data-field="Representante">&lt;&lt;Representante&gt;&gt;</div>
      <div class="role">GERENTE</div></br></br>
    </div>

    <div class="sig" id="sig-estipulante">
      <div class="hrline"></div>
      <div class="name" data-field="FirmaEstipulanteContrato">&lt;&lt;FirmaEstipulanteContrato&gt;&gt;</div>
      <div class="role">ESTIPULANTE</div></br></br>
    </div>
  </div>

  <!-- Buyers signatures: one block per buyer (hidden if estipulante provided) -->
  <div id="buyers"></div>

  <script>
    // List of all fields present between <<[ ... ]>> in the document
    var FIELD_NAMES = [
      "Representante","Datosrepresentante","NombreEmpresa","DatosInstrumento","DatosNotario",
      "DatoCompradorContrato","DatosLotificacionContrato","IdentificacionLotesVentaContrato","DatosLotesVentaContrato",
      "AlProminenteComprador","ElLosLotesDesccritos","QuienLoReciben","MontoLetras","Monto",
      "PrimaLetras","Prima","FinanciadoLetras","Financiado","CuotaLetras","Cuota",
      "PlazoLetras","RecargoLetras","RecargoApp","DatosCompradorFinalContrato","FechaLetras",
      "FirmaEstipulanteContrato","NombreCompradores","ProminenteComprador","ElProminenteComprador"
    ];

    // Fields to make bold (names, montos y cantidades)
    var BOLD_FIELDS = [
      "Representante","NombreEmpresa","DatosNotario",
      "DatoCompradorContrato","DatosLotificacionContrato","IdentificacionLotesVentaContrato","DatosLotesVentaContrato",
      "AlProminenteComprador","MontoLetras","Monto",
      "PrimaLetras","Prima","FinanciadoLetras","Financiado","CuotaLetras","Cuota",
      "PlazoLetras","RecargoLetras","RecargoApp","DatosCompradorFinalContrato",
      "FirmaEstipulanteContrato","NombreCompradores","ProminenteComprador","ElProminenteComprador"
    ];

    // Numeric fields to apply thousands separators
    var NUMERIC_FIELDS = ["Monto","Prima","Financiado","Cuota"];

    // Return query parameter (decoded)
    function getQueryParam(name) {
      var p = new URLSearchParams(window.location.search);
      return p.get(name) || "";
    }

    // Escape HTML to avoid injections when setting innerHTML
    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    // Format number with thousands separators (comma) preserving decimals if present
    function formatNumberWithThousands(v) {
      if (v === null || v === undefined) return v;
      var s = String(v).trim();
      if (s === "") return s;
      // Remove currency symbols and spaces (keep digits, dot, comma, minus)
      s = s.replace(/[^\d\.\,\\-]/g, '');
      // If both dot and comma present, treat dot as decimal and remove commas
      if (s.indexOf('.') !== -1 && s.indexOf(',') !== -1) {
        s = s.replace(/,/g, '');
      } else if (s.indexOf(',') !== -1 && s.indexOf('.') === -1) {
        // only commas -> treat comma as decimal separator
        s = s.replace(/,/g, '.');
      }
      var negative = s.charAt(0) === '-';
      if (negative) s = s.slice(1);
      var parts = s.split('.');
      var intPart = parts[0] || '0';
      var decPart = parts.length > 1 ? parts.slice(1).join('.') : '';
      intPart = intPart.replace(/\D/g, '');
      intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      var result = negative ? '-' + intPart : intPart;
      if (decPart) result += '.' + decPart;
      return result;
    }

    // Fill all elements that contain data-field attributes matching our fields
    function fillFields() {
      FIELD_NAMES.forEach(function(name) {
        var value = getQueryParam(name);
        if (value === null || value === undefined || value === "") return;
        var els = document.querySelectorAll('[data-field="' + name + '"]');
        els.forEach(function(el){
          var displayValue = value;
          // If numeric field, format with thousands separators
          if (NUMERIC_FIELDS.indexOf(name) !== -1) {
            displayValue = formatNumberWithThousands(value);
          }
          var safe = escapeHtml(displayValue);
          if (BOLD_FIELDS.indexOf(name) !== -1) {
            el.innerHTML = "<strong>" + safe + "</strong>";
          } else {
            el.textContent = displayValue;
          }
        });
      });
    }

    // Show/hide blocks depending on whether estipulante exists.
    // If estipulante provided -> show gerente then estipulante and HIDE buyers.
    // If not provided -> hide estipulante, show buyers and center gerente line (same width as buyers).
    function toggleSignatureBlocks() {
      var stip = getQueryParam("FirmaEstipulanteContrato");
      var sigEst = document.getElementById("sig-estipulante");
      var buyers = document.getElementById("buyers");
      var rep = document.getElementById("sig-representante");

      if (stip && stip.trim() !== "") {
        // ensure estipulante block visible
        if (sigEst) sigEst.style.display = "block";
        // hide buyers
        if (buyers) buyers.style.display = "none";
        // revert gerente styling (centered is already default)
        if (rep) {
          rep.style.display = "block";
        }
      } else {
        // no estipulante: hide estipulante block, show buyers, center gerente
        if (sigEst) sigEst.style.display = "none";
        if (buyers) buyers.style.display = "block";
        if (rep) {
          rep.style.display = "block";
        }
      }
    }

    // Render buyers signatures (one per buyer). Called regardless; toggleSignatureBlocks will hide/show #buyers.
    function renderBuyers() {
      var container = document.getElementById("buyers");
      container.innerHTML = "";

      var rawNames = getQueryParam("NombreCompradores");
      if (!rawNames) return;

      // Split names by comma (allow spaces) or by newline
      var names = rawNames.split(/\s*,\s*|\r?\n/).map(function(s){ return s.trim(); }).filter(function(s){ return s.length>0; });

      var rawRoles = getQueryParam("ProminenteComprador") || "";
      var roles = [];
      if (rawRoles.indexOf("|") !== -1) {
        roles = rawRoles.split("|").map(function(s){ return s.trim(); });
      } else if (rawRoles.indexOf(",") !== -1) {
        roles = rawRoles.split(/\s*,\s*/).map(function(s){ return s.trim(); });
      } else if (rawRoles.trim() !== "") {
        // same role for all buyers
        for (var k=0;k<names.length;k++) roles.push(rawRoles.trim());
      }

      for (var i=0;i<names.length;i++) {
        var name = names[i];
        var role = roles[i] || rawRoles || "COMPRADOR";

        var block = document.createElement("div");
        block.className = "buyer-block";

        // signature line
        var hr = document.createElement("div");
        hr.className = "hrline";
        block.appendChild(hr);

        // buyer name (bold, uppercase)
        var nameEl = document.createElement("div");
        nameEl.className = "buyer-name";
        nameEl.innerHTML = "<strong>" + escapeHtml(name.toUpperCase()) + "</strong>";
        block.appendChild(nameEl);

        // role (ProminenteComprador)
        var roleEl = document.createElement("div");
        roleEl.className = "buyer-role";
        roleEl.textContent = role;
        block.appendChild(roleEl);

        container.appendChild(block);
      }
    }

    // Normalize occurrences of vendor phrase to exact uppercase bold form
    function normalizeVendorPhrase() {
      var container = document.getElementById("content");
      if (!container) return;
      var html = container.innerHTML;

      // Replace variants (ÉL / EL, with possible spacing or accents) to standardized bold phrase
      html = html.replace(/\bÉL\s*\(LA\)\s*PROMINENTE\s*VENDEDOR\s*\(A\)\b/gi, 'EL (LA) PROMINENTE VENDEDOR (A)');
      html = html.replace(/\bEL\s*\(LA\)\s*PROMINENTE\s*VENDEDOR\s*\(A\)\b/gi, 'EL (LA) PROMINENTE VENDEDOR (A)');
      html = html.replace(/\bLA\s*PROMINENTE\s*VENDEDORA\b/gi, 'EL (LA) PROMINENTE VENDEDOR (A)');

      // Wrap the standardized phrase in <strong> everywhere
      html = html.replace(/EL\s*\(LA\)\s*PROMINENTE\s*VENDEDOR\s*\(A\)/g, '<strong>EL (LA) PROMINENTE VENDEDOR (A)</strong>');

      container.innerHTML = html;
    }

    // Bold enumerators written in words in Spanish (handles many variants and punctuation)
    function boldEnumerators() {
      var container = document.getElementById("content");
      if (!container) return;
      var html = container.innerHTML;

      // List of ordinal bases (masculine/feminine and accented variants)
      var bases = [
        'PRIMERO','PRIMERA','SEGUNDO','SEGUNDA','TERCERO','TERCERA','CUARTO','CUARTA',
        'QUINTO','QUINTA','SEXTO','SEXTA','SEPTIMO','SEPTIMA','SÉPTIMO','SÉPTIMA',
        'OCTAVO','OCTAVA','NOVENO','NOVENA','DECIMO','DECIMA','DÉCIMO','DÉCIMA',
        'UNDÉCIMO','UNDECIMO','UNDÉCIMA','UNDECIMA','DUODÉCIMO','DUODÉCIMA',
        'DECIMOTERCERO','DECIMOTERCERA','DECIMOCUARTO','DECIMOQUINTO','DECIMOSEXTO',
        'DECIMOSEPTIMO','DECIMOOCTAVO','DECIMONOVENO','VIGESIMO','VIGESIMA','VIGÉSIMO','VIGÉSIMA',
        'VIGESIMOPRIMERO','VIGESIMOPRIMERA','TRIGESIMO','TRIGESIMA','TRIGÉSIMO','TRIGÉSIMA',
        'CUADRAGESIMO','CUADRAGESIMA','QUINCUAGESIMO','QUINCUAGESIMA'
      ];

      // prefixes for composite forms (DECIMO, VIGESIMO, etc.)
      var prefixes = ['DECIMO','DÉCIMO','VIGESIMO','VIGÉSIMO','TRIGESIMO','TRIGÉSIMO','CUADRAGESIMO','CUADRAGÉSIMO','QUINCUAGESIMO'];
      // suffixes to form composite like "DECIMO PRIMERO"
      var suffixes = ['PRIMERO','PRIMERA','SEGUNDO','SEGUNDA','TERCERO','TERCERA','CUARTO','CUARTA','QUINTO','QUINTA'];

      var composites = [];
      prefixes.forEach(function(p){
        suffixes.forEach(function(s){
          // allow space or hyphen between parts
          composites.push(p + '\\s+' + s);
          composites.push(p + '-' + s);
        });
      });

      var all = bases.concat(prefixes).concat(composites);

      // sort longer first to avoid partial matches
      all.sort(function(a,b){ return b.length - a.length; });

      // build alternation, escape already includes backslashes in composites
      var regexBody = all.join('|');

      // allow optional leading hyphen/dash and optional preceding spaces/newline
      // capture trailing punctuation variants: :, ., .-, -:, ,, ) etc.
      var regex = new RegExp('(^|\\n|>)([\\s\\-\\u2013\\u2014]*?)(' + regexBody + ')(\\s*(?:\\.|:|\\.|\\-\\.|\\,|\\)|\\]|\\:|\\-){0,2})', 'gim');

      // Replace matches but avoid touching inside tags by ensuring group1 isn't within a tag start (we included > anchor to start after tags)
      html = html.replace(regex, function(match, g1, g2, g3, g4){
        // preserve the prefix (g1/g2) then wrap g3+g4
        return g1 + g2 + '<span class="enumerator">' + g3 + g4 + '</span>';
      });

      container.innerHTML = html;
    }

    // Bold the specific long contractual section and ensure vendor phrase replacement inside it
    function boldSpecificSection() {
      var container = document.getElementById("content");
      if (!container) return;
      var html = container.innerHTML;

      // From "Quedando entendido" up to "POR CUOTA RETRASADA." inclusive -> make bold
      var pattern = /Quedando entendido[\s\S]*?POR CUOTA RETRASADA\./i;
      html = html.replace(pattern, function(m){
        return '<strong>' + m + '</strong>';
      });

      // Also replace "LA PROMINENTE VENDEDORA" occurrences to standardized bold phrase
      html = html.replace(/LA PROMINENTE VENDEDORA/gi, function(){
        return '<strong>EL (LA) PROMINENTE VENDEDOR (A)</strong>';
      });

      container.innerHTML = html;
    }

    // On load: fill fields, normalize vendor phrase, toggle signature blocks, render buyers, then apply bolding
    window.onload = function() {
      fillFields();
      normalizeVendorPhrase();
      toggleSignatureBlocks();
      renderBuyers();

      // Apply textual transformations after fields are filled
      boldEnumerators();
      boldSpecificSection();

      // Small timeout so rendering completes; preserve original behavior of opening print dialog
      setTimeout(function(){ window.print(); }, 500);
    };
  </script>
</body>
</html>
